# Code Review 工作流程

## 概述

本文档定义了进行 Code Review 的标准流程。该流程专注于如何系统化地审查代码变更，而不是具体的代码审查规则（审查规则由其他 skills 提供）。

## 标准流程

### 阶段 1: 获取 MR 信息

使用 MCP 工具从 codehub-review-mcp 获取 MR 的基本信息：

1. **获取 MR 元数据**
   - MR 链接/ID
   - 提交者信息
   - 提交时间
   - MR 标题和描述
   - 目标分支

2. **获取代码变更信息**
   - 变更的文件列表
   - 每个文件的 diff 统计（增删行数）
   - 总体变更规模

**决策点**: 根据变更复杂度选择后续流程

```
变更复杂度评估:
- 简单: 单文件、少量改动（< 100 行）、无跨文件影响
  → 进入阶段 2A: 直接 Review

- 中等: 多文件、中等改动（100-500 行）、有限的跨文件影响
  → 进入阶段 2B: 深度 Review

- 复杂: 大量文件、大量改动（> 500 行）、复杂的跨文件影响或重构
  → 进入阶段 2C: 本地上下文 Review
```

### 阶段 2A: 直接 Review（简单变更）

1. **逐文件 Review**
   - 读取每个变更文件的 diff
   - 理解变更目的和影响
   - 识别潜在问题

2. **使用编码标准技能**
   - 调用相关的编码规范 skill
   - 按照规范检查代码质量

3. **生成 Review 意见**
   - 汇总发现的问题
   - 按优先级分类（严重/中等/建议）
   - 提供具体的改进建议

### 阶段 2B: 深度 Review（中等变更）

1. **理解变更上下文**
   - 读取相关文件的内容（不仅是 diff）
   - 理解变更前后的代码结构
   - 分析变更的影响范围

2. **系统性 Review**
   - 按功能模块或逻辑流分组审查
   - 检查跨文件的一致性
   - 验证边界情况

3. **使用编码标准技能**
   - 调用相关的编码规范 skill
   - 进行全面的质量检查

4. **生成详细的 Review 报告**
   - 问题描述和位置
   - 影响分析
   - 具体的修复建议

### 阶段 2C: 本地上下文 Review（复杂变更）

当变更过于复杂，仅通过 diff 无法充分理解时：

1. **下载并应用 Patch**
   - 使用 MCP 工具下载完整的 diff 文件
   - 将 patch 应用到本地工程
   - 验证 patch 应用成功

2. **本地代码分析**
   - 使用完整代码库进行静态分析
   - 理解整体架构和依赖关系
   - 运行测试（如果可用）

3. **深度 Review**
   - 结合完整上下文进行审查
   - 分析对系统的影响
   - 评估性能和安全影响

4. **生成综合 Review 报告**
   - 详细的问题列表
   - 架构层面的建议
   - 风险评估

### 阶段 3: 输出 Review 结果

无论使用哪个子流程，最终都应生成结构化的 Review 结果：

1. **摘要**
   - 变更概述
   - 主要发现
   - 总体评价

2. **问题列表**
   - 按严重程度分组
   - 每个问题包含：
     * 问题描述
     * 文件和行号
     * 具体建议
     * 引用的规范（如适用）

3. **正面反馈**
   - 做得好的地方
   - 值得学习的实践

4. **后续行动**
   - 必须修复的问题
   - 建议修改的问题
   - 可选的优化建议

## 关键原则

1. **理解优先于批评** - 先理解变更的目的，再进行审查
2. **建设性反馈** - 提供具体可行的改进建议
3. **上下文感知** - 根据变更规模调整审查深度
4. **规范驱动** - 使用编码规范 skill 确保一致性
5. **关注影响** - 不仅看代码本身，更要理解其影响范围

## 工具使用

参见 [mcp-tools-guide.md](mcp-tools-guide.md) 了解可用的 MCP 工具及其使用方法。
